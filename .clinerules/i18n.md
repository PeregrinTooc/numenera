# Internationalization (i18n) Rules

**Context:** Translation requirements and internationalization standards

---

## Rule #4: üåç i18n Everything - No Hardcoded Text

**ALL user-facing text MUST use the `t()` function with translation keys.**

### MANDATORY Requirements:

- Import: `import { t } from "../i18n/index.js";`
- Use: `{t("your.translation.key")}`
- Keys must exist in BOTH `en.json` AND `de.json`
- Pre-commit hook will BLOCK commits if keys are missing
- Exception: **None.** Pre-commit hook enforces this automatically.

---

## What Needs Translation

### ‚úÖ MUST be translated:

- All visible text in UI
- Button labels
- Headings and titles
- Messages and notifications
- Error messages
- Tooltips and help text
- Placeholders in inputs
- Alt text for images (when user-visible)
- ARIA labels (when user-visible)

### ‚ùå Does NOT need translation:

- HTML attributes: `class`, `type`, `role`
- CSS class names
- Code identifiers
- `data-testid` attributes
- Technical constants
- Variable/function names
- Comment text in code

---

## Translation File Structure

### Location:

```
src/i18n/locales/
‚îú‚îÄ‚îÄ en.json  # English translations (default)
‚îî‚îÄ‚îÄ de.json  # German translations
```

### Structure Pattern:

```json
{
  "app": {
    "title": "App level strings",
    "loading": "Generic UI elements"
  },
  "character": {
    "name": "Character properties",
    "tier": "More properties",
    "stats": {
      "might": "Nested for organization",
      "speed": "Group related translations"
    }
  },
  "errors": {
    "validation": "Error messages",
    "network": "Grouped by error type"
  },
  "buttons": {
    "save": "Common UI elements",
    "cancel": "Reusable across features"
  }
}
```

### Organization Guidelines:

- Group by feature/component
- Use nested objects for sub-categories
- Keep keys descriptive but concise
- Use dot notation for nesting
- Reuse common keys (buttons, errors, etc.)

---

## Usage Examples

### Basic Usage:

```typescript
import { t } from "../i18n/index.js";

// ‚ùå BAD - Hardcoded text
<h1>Character Sheet</h1>
<button>Save</button>
<div>A tier {tier}</div>

// ‚úÖ GOOD - Using translation keys
<h1>{t("app.characterSheet")}</h1>
<button>{t("buttons.save")}</button>
<div>{t("character.sentence.prefix")} {tier}</div>
```

### In Attributes:

```typescript
// ‚úÖ GOOD - Translate ARIA labels
<button aria-label={t("buttons.save.ariaLabel")}>
  <SaveIcon />
</button>

// ‚úÖ GOOD - Translate placeholders
<input
  type="text"
  placeholder={t("character.name.placeholder")}
/>

// ‚úÖ GOOD - Don't translate technical attributes
<div
  class="stat-pool"           // CSS class - NO translation
  data-testid="might-pool"    // Test ID - NO translation
  role="region"               // ARIA role - NO translation
  aria-label={t("stats.might.label")}  // User-visible - YES translation
>
```

### Error Messages:

```typescript
// ‚úÖ GOOD
try {
  await saveCharacter(character);
} catch (error) {
  console.error("Save failed:", error);
  showNotification(t("errors.saveFailed"), "error");
}

// ‚ùå BAD
try {
  await saveCharacter(character);
} catch (error) {
  console.error("Save failed:", error);
  showNotification("Failed to save character", "error");
}
```

---

## Adding New Translations

### Step-by-Step Process:

1. **Add key to English file** (`src/i18n/locales/en.json`):

```json
{
  "character": {
    "stats": {
      "might": "Might",
      "newStat": "New Stat Name" // ‚Üê Add here
    }
  }
}
```

2. **Add corresponding German translation** (`src/i18n/locales/de.json`):

```json
{
  "character": {
    "stats": {
      "might": "Macht",
      "newStat": "Neuer Stat Name" // ‚Üê Add here
    }
  }
}
```

3. **Use in component**:

```typescript
<div>{t("character.stats.newStat")}</div>
```

4. **Pre-commit hook will verify** both keys exist before allowing commit

---

## Pre-Commit Hook Enforcement

### What It Does:

```bash
npm run check:i18n
```

- Scans all components for `t()` function calls
- Extracts all translation keys used
- Verifies every key exists in BOTH `en.json` AND `de.json`
- **BLOCKS the commit if any keys are missing**
- Reports exactly which keys need to be added

### Example Output:

```
‚ùå Translation check failed!

Missing keys in en.json:
  - character.stats.newStat

Missing keys in de.json:
  - character.stats.newStat
  - buttons.export

Please add these keys before committing.
```

### How to Fix:

1. Check error message for missing keys
2. Add keys to `src/i18n/locales/en.json`
3. Add same keys to `src/i18n/locales/de.json`
4. Try commit again
5. Hook will verify and allow commit if all keys present

---

## Common Translation Keys

### Buttons:

```json
{
  "buttons": {
    "save": "Save",
    "cancel": "Cancel",
    "delete": "Delete",
    "edit": "Edit",
    "add": "Add",
    "remove": "Remove",
    "confirm": "Confirm",
    "back": "Back",
    "next": "Next",
    "close": "Close"
  }
}
```

### Common UI:

```json
{
  "common": {
    "loading": "Loading...",
    "error": "Error",
    "success": "Success",
    "warning": "Warning",
    "info": "Information",
    "required": "Required",
    "optional": "Optional"
  }
}
```

### Validation:

```json
{
  "validation": {
    "required": "This field is required",
    "minLength": "Minimum length is {min} characters",
    "maxLength": "Maximum length is {max} characters",
    "invalidFormat": "Invalid format",
    "mustBeNumber": "Must be a number"
  }
}
```

---

## Interpolation (If Supported)

If the i18n library supports interpolation:

```typescript
// Translation file
{
  "character": {
    "description": "A tier {tier} {type} who {focus}"
  }
}

// Usage
<div>
  {t("character.description", {
    tier: character.tier,
    type: character.type,
    focus: character.focus
  })}
</div>
```

**Note:** Check current implementation to confirm interpolation support.

---

## Language Selection

### Current Languages:

- **English (en)**: Default, used for development and testing
- **German (de)**: Production language

### Switching Languages:

```typescript
import { changeLanguage } from "../i18n/index.js";

// Switch to German
changeLanguage("de");

// Switch to English
changeLanguage("en");
```

---

## Troubleshooting

### "Pre-commit hook blocked my commit"

**Cause:** Missing translation keys

**Solution:**

1. Read the error message
2. Note which keys are missing
3. Add keys to both `en.json` and `de.json`
4. Commit again

### "Key not found" warning in browser console

**Cause:** Using a translation key that doesn't exist

**Solution:**

1. Check the key name for typos
2. Verify key exists in both translation files
3. Restart dev server if needed

### "Text still appears in English in German mode"

**Cause:** Hardcoded text instead of using `t()`

**Solution:**

1. Find the hardcoded text in component
2. Add translation key to both files
3. Replace text with `{t("your.key")}`

---

## Best Practices

### ‚úÖ DO:

- Use descriptive key names
- Group related translations
- Keep translations consistent
- Test in both languages
- Use translation keys for all user-visible text

### ‚ùå DON'T:

- Hardcode any user-visible text
- Use abbreviations in keys
- Skip either language file
- Bypass the pre-commit hook
- Translate technical identifiers

---

## Documentation

For complete guide including:

- Detailed usage examples
- Advanced patterns
- Troubleshooting
- Translation workflow

See: `docs/I18N.md`

---

## Related Rules

- **Code Quality:** See `code-quality.md` for error message standards
- **Workflow:** See `workflow.md` for commit process
- **Testing:** See `testing.md` for testing i18n

---

**i18n requirements are ABSOLUTE and enforced by pre-commit hooks.**
