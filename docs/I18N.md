# Internationalization (i18n) Guide

## Overview

The Numenera Character Sheet project uses internationalization to support multiple languages. All user-facing text must be internationalized using the `t()` function.

---

## Current Languages

- **English (en)** - Default language
- **German (de)** - Full translation support

---

## Translation Files

Located in `src/i18n/locales/`:

- `en.json` - English translations
- `de.json` - German translations

---

## Using Translations

### Import the `t()` function

```typescript
import { t } from "../i18n/index.js";
```

### Use in lit-html templates

```typescript
render() {
  return html`
    <div>${t("character.name")}</div>
    <button>${t("buttons.load")}</button>
  `;
}
```

### Translation Key Structure

```json
{
  "app": {
    "title": "Numenera Character Sheet"
  },
  "buttons": {
    "load": "Load",
    "clear": "Clear"
  },
  "character": {
    "sentence": {
      "prefix": "A tier",
      "connector": "who"
    },
    "portrait": "Portrait"
  }
}
```

---

## Adding New Translations

### 1. Add keys to `en.json`

```json
{
  "newSection": {
    "label": "New Label",
    "description": "Description text"
  }
}
```

### 2. Add corresponding German translations to `de.json`

```json
{
  "newSection": {
    "label": "Neues Label",
    "description": "Beschreibungstext"
  }
}
```

### 3. Use in component

```typescript
${t("newSection.label")}
${t("newSection.description")}
```

---

## Language Switching

The app detects language via URL parameter:

- `?lang=en` - English
- `?lang=de` - German
- No parameter - Browser default (falls back to English)

---

## Testing Translations

### Manual Testing

1. **English:**

   ```
   http://localhost:3000/numenera/
   ```

2. **German:**
   ```
   http://localhost:3000/numenera/?lang=de
   ```

### E2E Tests

Located in `tests/e2e/features/i18n.feature`:

- Tests English (default)
- Tests German via `?lang=de`
- Tests language persistence

---

## Rules & Best Practices

### ✅ DO

- **Always use `t()` for user-facing text**

  ```typescript
  ${t("buttons.load")}  // ✅ Good
  ```

- **Keep translation keys organized by section**

  ```json
  {
    "character": { ... },
    "stats": { ... },
    "cyphers": { ... }
  }
  ```

- **Use nested keys for related translations**
  ```json
  {
    "textFields": {
      "background": {
        "label": "Background",
        "empty": "No background"
      }
    }
  }
  ```

### ❌ DON'T

- **Hardcode English text**

  ```typescript
  ${
  "Load"}  // ❌ Bad
  ```

- **Use translation keys for technical IDs**

  ```typescript
  data-testid="load-button"  // ✅ OK - technical identifier
  ```

- **Translate CSS classes or code strings**
  ```typescript
  class="basic-info-card"  // ✅ OK - CSS class
  ```

---

## ESLint i18n Checking

### Status: Currently Disabled

We attempted to use `eslint-plugin-i18next` but it was too aggressive with lit-html templates, flagging every `html\`\`` template as a violation.

### Alternative: Manual Code Review

**During code review, check for:**

1. ✅ All user-facing text uses `t()`
2. ✅ New translation keys added to both `en.json` and `de.json`
3. ✅ German translations are accurate and natural
4. ✅ i18n tests updated if new sections added

### Future: Custom ESLint Rule

We may create a custom ESLint rule that:

- Understands lit-html syntax
- Only flags actual user-facing text
- Ignores HTML attributes, comments, technical strings

---

## Numenera Sentence Format

The character description uses a special sentence format that requires careful translation:

### English Structure

```
A tier 3 Strong Glaive who Bears a Halo of Fire
```

Translation keys:

- `character.sentence.prefix` = "A tier"
- `character.sentence.connector` = "who"

### German Structure

```
Stufe 3 Strong Glaive mit Bears a Halo of Fire
```

Translation keys:

- `character.sentence.prefix` = "Stufe"
- `character.sentence.connector` = "mit"

**Note:** German omits "A" and uses "mit" (with) instead of "who" for more natural phrasing.

---

## Common Translation Keys

### App

- `app.title` - Page title

### Buttons

- `buttons.load` - Load character button
- `buttons.clear` - Clear character button

### Character Info

- `character.sentence.prefix` - "A tier" / "Stufe"
- `character.sentence.connector` - "who" / "mit"
- `character.portrait` - "Portrait" / "Porträt"

### Stats

- `stats.heading` - "Stats" / "Attribute"
- `stats.might` - "Might" / "Macht"
- `stats.speed` - "Speed" / "Geschwindigkeit"
- `stats.intellect` - "Intellect" / "Intellekt"
- `stats.pool` - "Pool"
- `stats.edge` - "Edge" / "Vorteil"
- `stats.current` - "Current" / "Aktuell"

### Empty States

- `*.empty` - Used for empty list messages
  - `cyphers.empty` - "No cyphers" / "Keine Cypher"
  - `artifacts.empty` - "No artifacts" / "Keine Artefakte"

---

## Project Rules (from RULES.md)

**Rule #5:** All user-facing text must be internationalized

- ✅ Use `t()` function from `src/i18n/index.ts`
- ✅ Add keys to both `en.json` and `de.json`
- ✅ Technical identifiers (testids, classes) don't need i18n
- ✅ Test both languages before committing

---

## Troubleshooting

### Translation not showing

1. **Check key exists in locale file**

   ```bash
   grep -r "your.key" src/i18n/locales/
   ```

2. **Verify `t()` is imported**

   ```typescript
   import { t } from "../i18n/index.js";
   ```

3. **Check language parameter**
   ```
   ?lang=de  ✅ Correct
   ?lang=german  ❌ Wrong
   ```

### German text not displaying

1. **Verify de.json has the key**
2. **Check JSON syntax** (commas, brackets)
3. **Clear browser cache**
4. **Check URL has `?lang=de`**

---

## Future Improvements

1. **Custom ESLint Rule**
   - Specifically for lit-html templates
   - Only flag actual violations
   - Provide auto-fix suggestions

2. **Translation Coverage Report**
   - Script to find missing keys
   - Compare en.json vs de.json
   - Report untranslated keys

3. **More Languages**
   - Spanish (es)
   - French (fr)
   - Add language selector UI

4. **Translation Validation**
   - Check for missing placeholders
   - Verify interpolation syntax
   - Detect duplicate keys

---

## Resources

- [i18next Documentation](https://www.i18next.com/)
- [lit-html Documentation](https://lit.dev/)
- [Project Rules](./RULES.md)
- [E2E i18n Tests](../tests/e2e/features/i18n.feature)
